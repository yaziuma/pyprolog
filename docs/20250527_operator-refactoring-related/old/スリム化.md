# Prologã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼ - æ©Ÿèƒ½é‡è¤‡åˆ†æã¨ã‚¹ãƒªãƒ åŒ–ææ¡ˆ

## 1. æ©Ÿèƒ½é‡è¤‡ç®‡æ‰€ã®è©³ç´°åˆ†æ

### ğŸ”´ **é‡å¤§ãªé‡è¤‡**

#### 1.1 Numberã‚¯ãƒ©ã‚¹ã®é‡è¤‡å®šç¾©
```python
# core/types.py - åŸºæœ¬çš„ãªNumber
@dataclass
class Number(BaseTerm):
    value: Union[int, float]
    # åŸºæœ¬ãƒ¡ã‚½ãƒƒãƒ‰ã®ã¿

# parser/types.py - æ‹¡å¼µNumberï¼ˆç®—è¡“æ¼”ç®—ä»˜ãï¼‰
class Number(Term):
    def __init__(self, value):
        super().__init__(value)
        self.value = value
    
    # å¤§é‡ã®ç®—è¡“ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆadd, subtract, multiply, divide, etc.ï¼‰
    # å¤§é‡ã®æ¯”è¼ƒãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆequal, less, greater, etc.ï¼‰
```
**å•é¡Œ**: åŒåã‚¯ãƒ©ã‚¹ã§ç•°ãªã‚‹å®Ÿè£…ã€æ··ä¹±ã®åŸå› 

#### 1.2 æ¼”ç®—å­è©•ä¾¡ã®é‡è¤‡
```python
# runtime/interpreter.py - Runtimeå†…ã®æ¼”ç®—å­è©•ä¾¡
def _create_arithmetic_evaluator(self, op_info):
    # ç®—è¡“æ¼”ç®—å­ã®è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯

# runtime/math_interpreter.py - MathInterpreterå†…ã®æ¼”ç®—å­è©•ä¾¡
def evaluate_binary_op(self, op_symbol, left_val, right_val):
    # åŒã˜ç®—è¡“æ¼”ç®—å­ã®è©•ä¾¡ãƒ­ã‚¸ãƒƒã‚¯

# parser/types.py - Numberå†…ã®æ¼”ç®—å­è©•ä¾¡
def add(self, other):
    # åŒã˜åŠ ç®—ãƒ­ã‚¸ãƒƒã‚¯
```

#### 1.3 ãƒˆãƒ¼ã‚¯ãƒ³ã‚¿ã‚¤ãƒ—ç®¡ç†ã®é‡è¤‡
```python
# parser/token_type.py - é™çš„enum + å‹•çš„ç®¡ç†
class TokenType(Enum):
    # é™çš„å®šç¾©

class TokenTypeManager:
    # å‹•çš„ãƒˆãƒ¼ã‚¯ãƒ³è¿½åŠ 

# core/operators.py - æ¼”ç®—å­-ãƒˆãƒ¼ã‚¯ãƒ³å¯¾å¿œ
class OperatorInfo:
    token_type: str  # ãƒˆãƒ¼ã‚¯ãƒ³ã‚¿ã‚¤ãƒ—ã‚’æ–‡å­—åˆ—ã§ä¿æŒ
```

### ğŸŸ¡ **ä¸­ç¨‹åº¦ã®é‡è¤‡**

#### 1.4 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®åˆ†æ•£
```python
# è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã§é¡ä¼¼ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
# cli/repl.py, parser/parser.py, runtime/interpreter.py
# å„æ‰€ã§ç‹¬è‡ªã®ã‚¨ãƒ©ãƒ¼å‡¦ç†å®Ÿè£…
```

#### 1.5 å¤‰æ•°æŸç¸›æ“ä½œã®é‡è¤‡
```python
# core/binding_environment.py
# core/merge_bindings.py
# å¤‰æ•°æŸç¸›ã®æ“ä½œãŒåˆ†æ•£
```

## 2. ã‚¹ãƒªãƒ åŒ–ææ¡ˆ

### ğŸ¯ **Phase 1: é‡è¤‡å‰Šé™¤ï¼ˆé«˜å„ªå…ˆåº¦ï¼‰**

#### 2.1 Numberã‚¯ãƒ©ã‚¹ã®çµ±åˆ
```python
# ææ¡ˆ: core/types.py ã®ã¿ã«çµ±åˆ
@dataclass
class Number(BaseTerm):
    value: Union[int, float]
    
    # åŸºæœ¬æ“ä½œã®ã¿ä¿æŒ
    def __eq__(self, other): ...
    def __hash__(self): ...
    
    # ç®—è¡“æ“ä½œã¯ MathInterpreter ã«å§”è­²
    # parser/types.py ã® Number ã¯å‰Šé™¤
```

#### 2.2 æ¼”ç®—å­è©•ä¾¡ã®ä¸€å…ƒåŒ–
```python
# ææ¡ˆ: MathInterpreter ã«ä¸€å…ƒåŒ–
class MathInterpreter:
    @staticmethod
    def evaluate_operator(op_symbol, *args):
        # å…¨ã¦ã®ç®—è¡“ãƒ»æ¯”è¼ƒæ¼”ç®—å­ã‚’ã“ã“ã§å‡¦ç†
        pass

# Runtime ã‹ã‚‰ MathInterpreter ã¸ã®å§”è­²ã®ã¿
# parser/types.py ã®æ¼”ç®—ãƒ¡ã‚½ãƒƒãƒ‰ã¯å‰Šé™¤
```

#### 2.3 ä¸è¦ã‚¯ãƒ©ã‚¹ã®å‰Šé™¤
```python
# å‰Šé™¤å¯¾è±¡:
# - parser/types.py ã® Arithmetic ã‚¯ãƒ©ã‚¹
# - parser/types.py ã® Logic ã‚¯ãƒ©ã‚¹
# - parser/types.py ã® TermFunction ã‚¯ãƒ©ã‚¹
# ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã¯æ—¢å­˜ã®ã‚¯ãƒ©ã‚¹ã§ä»£æ›¿å¯èƒ½
```

### ğŸ¯ **Phase 2: ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç°¡ç´ åŒ–ï¼ˆä¸­å„ªå…ˆåº¦ï¼‰**

#### 2.4 ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼éšå±¤ã®ç°¡ç´ åŒ–
```python
# ç¾åœ¨: Runtime â†’ LogicInterpreter â†’ Runtime (å¾ªç’°)
# ææ¡ˆ: Runtime ã®ã¿ã§çµ±åˆå‡¦ç†

class Runtime:
    def __init__(self, rules):
        self.rules = rules
        self.math_eval = MathInterpreter()  # æ•°å­¦å‡¦ç†ã®ã¿å§”è­²
        # LogicInterpreter ã¯å‰Šé™¤ã€æ©Ÿèƒ½ã‚’ Runtime ã«çµ±åˆ
    
    def execute(self, goal, env):
        # è«–ç†å‡¦ç†ã‚‚ã“ã“ã§ç›´æ¥å®Ÿè¡Œ
        pass
```

#### 2.5 ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã®ç°¡ç´ åŒ–
```python
# ææ¡ˆ: é™çš„enum ã®ã¿ä½¿ç”¨ã€å‹•çš„æ©Ÿèƒ½ã¯å‰Šé™¤
class TokenType(Enum):
    # å…¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’é™çš„å®šç¾©
    # TokenTypeManager ã¯å‰Šé™¤
    pass
```

### ğŸ¯ **Phase 3: ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã®æœ€é©åŒ–ï¼ˆä½å„ªå…ˆåº¦ï¼‰**

#### 2.6 ãƒ•ã‚¡ã‚¤ãƒ«çµ±åˆæ¡ˆ
```python
# çµ±åˆæ¡ˆ:
core/
â”œâ”€â”€ types.py          # å…¨åŸºæœ¬å‹ + Rule/Fact
â”œâ”€â”€ environment.py    # BindingEnvironment + mergeæ©Ÿèƒ½
â”œâ”€â”€ operators.py      # æ¼”ç®—å­ç®¡ç†ï¼ˆç°¡ç´ åŒ–ç‰ˆï¼‰
â””â”€â”€ errors.py         # å…¨ã‚¨ãƒ©ãƒ¼å‹

parser/
â”œâ”€â”€ lexer.py          # Scanner + Token + TokenTypeçµ±åˆ
â””â”€â”€ parser.py         # Parser ã®ã¿

runtime/
â”œâ”€â”€ interpreter.py    # Runtime + è«–ç†å‡¦ç†çµ±åˆ
â”œâ”€â”€ math.py          # MathInterpreterï¼ˆç°¡ç´ åŒ–ç‰ˆï¼‰
â””â”€â”€ builtins.py      # çµ„ã¿è¾¼ã¿è¿°èªã®ã¿
```

## 3. å‰Šé™¤å¯èƒ½ãªã‚³ãƒ¼ãƒ‰é‡ã®è©¦ç®—

### 3.1 å®Œå…¨å‰Šé™¤å¯¾è±¡
- `parser/types.py` â†’ **146è¡Œå‰Šé™¤**
- `runtime/logic_interpreter.py` â†’ **200è¡Œå‰Šé™¤** (æ©Ÿèƒ½ã¯Runtimeã«çµ±åˆ)
- `parser/token_type.py` ã®TokenTypeManager â†’ **80è¡Œå‰Šé™¤**
- `core/merge_bindings.py` ã®é‡è¤‡æ©Ÿèƒ½ â†’ **100è¡Œå‰Šé™¤**

### 3.2 å¤§å¹…ç°¡ç´ åŒ–å¯¾è±¡
- `runtime/interpreter.py` â†’ **300è¡Œã‹ã‚‰150è¡Œã«å‰Šæ¸›**
- `core/operators.py` â†’ **200è¡Œã‹ã‚‰100è¡Œã«å‰Šæ¸›**

### 3.3 å‰Šæ¸›åŠ¹æœ
- **ç·è¡Œæ•°**: ç´„**1000è¡Œå‰Šé™¤** (å…¨ä½“ã®ç´„40%å‰Šæ¸›)
- **ã‚¯ãƒ©ã‚¹æ•°**: 24å€‹ â†’ **16å€‹** (8å€‹å‰Šé™¤)
- **ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 16å€‹ â†’ **11å€‹** (5å€‹å‰Šé™¤)

## 4. ã‚¹ãƒªãƒ åŒ–å®Ÿè£…ãƒ—ãƒ©ãƒ³

### Step 1: é‡è¤‡ã‚¯ãƒ©ã‚¹å‰Šé™¤ (1-2æ™‚é–“)
1. `parser/types.py` ã® Number ã‚¯ãƒ©ã‚¹å‰Šé™¤
2. ç®—è¡“æ“ä½œã‚’ MathInterpreter ã«ç§»å‹•
3. ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡ã®ä¿®æ­£

### Step 2: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼çµ±åˆ (2-3æ™‚é–“)
1. LogicInterpreter ã®æ©Ÿèƒ½ã‚’ Runtime ã«ç§»å‹•
2. å¾ªç’°ä¾å­˜ã®è§£æ¶ˆ
3. ãƒ†ã‚¹ãƒˆã®ä¿®æ­£

### Step 3: ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ç°¡ç´ åŒ– (1æ™‚é–“)
1. TokenTypeManager å‰Šé™¤
2. é™çš„ TokenType ã®ã¿ä½¿ç”¨
3. å‹•çš„ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆæ©Ÿèƒ½ã®å‰Šé™¤

### Step 4: ãƒ•ã‚¡ã‚¤ãƒ«çµ±åˆ (1æ™‚é–“)
1. å°ã•ãªãƒ•ã‚¡ã‚¤ãƒ«ã®çµ±åˆ
2. ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ§‹é€ ã®æ•´ç†

## 5. ãƒªã‚¹ã‚¯è©•ä¾¡

### ğŸŸ¢ ä½ãƒªã‚¹ã‚¯
- Number ã‚¯ãƒ©ã‚¹é‡è¤‡å‰Šé™¤
- æœªä½¿ç”¨ã‚¯ãƒ©ã‚¹ã®å‰Šé™¤
- ãƒ•ã‚¡ã‚¤ãƒ«çµ±åˆ

### ğŸŸ¡ ä¸­ãƒªã‚¹ã‚¯
- LogicInterpreter ã® Runtime ã¸ã®çµ±åˆ
- ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã®ç°¡ç´ åŒ–

### ğŸ”´ é«˜ãƒªã‚¹ã‚¯
- æ¼”ç®—å­è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ ã®å¤§å¹…å¤‰æ›´
- æ—¢å­˜APIã®äº’æ›æ€§ç ´ç¶»

## 6. æ¨å¥¨å®Ÿè£…é †åº

1. **Phase 1**: é‡è¤‡ã‚¯ãƒ©ã‚¹å‰Šé™¤ (å®‰å…¨)
2. **Phase 2**: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ—ãƒªã‚¿ãƒ¼çµ±åˆ (è¦æ³¨æ„)
3. **Phase 3**: ãƒ•ã‚¡ã‚¤ãƒ«æ•´ç† (æœ€çµ‚èª¿æ•´)

ã“ã®æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€æ©Ÿèƒ½ã‚’ç¶­æŒã—ãªãŒã‚‰**ç´„40%ã®ã‚³ãƒ¼ãƒ‰å‰Šæ¸›**ãŒå¯èƒ½ã§ã™ã€‚ç‰¹ã«Phase 1ã ã‘ã§ã‚‚å¤§ããªæ”¹å–„åŠ¹æœãŒæœŸå¾…ã§ãã¾ã™ã€‚