# 詳細設計書 対応順序

本ドキュメントは、`docs/20250523/` 配下に作成された各詳細設計書の推奨される対応順序を記述します。
依存関係を考慮し、以下の順序で改修を進めることを推奨します。

## 1. コアなデータ構造の整備

中核となるデータ構造の表現を最初に統一します。

1.  **リスト表現の整合性**
    *   ファイル: `詳細設計書_リスト表現の整合性.md`
    *   概要: Prologリストの内部表現 (`Term('.', ...)` と `Atom('[]')`) をプロジェクト全体で統一し、パーサーとテストコードをこれに合わせます。これは他の多くの改修の前提となります。

## 2. パーサーの改修

インタープリタが処理する項の構造を正しく構築できるように、パーサーを先に改修します。

1.  **ルールボディ (`_parse_rule`) における算術式 (`is`) の処理改善**
    *   ファイル: `詳細設計書_パーサー_算術式.md`
    *   概要: `Y is Expression` 形式の算術式を正しくパースできるようにします。
2.  **ルールボディ (`_parse_rule`) における比較演算子の処理追加**
    *   ファイル: `詳細設計書_パーサー_比較演算子.md`
    *   概要: `X > Y`, `A =:= B` などの比較演算を正しくパースできるようにします。
3.  **ルールボディ (`_parse_rule`) における結合 (Conjunction) の処理確認**
    *   ファイル: `詳細設計書_パーサー_結合処理確認.md`
    *   概要: 算術式や比較演算を含む複数のゴールがコンマで結合されるケースを正しく処理できるか確認します。

## 3. インタープリタの改修 - 基本機能

パーサーによって生成された項を評価・実行するための基本的な機能を実装します。

1.  **単一化処理 (`BindingEnvironment.unify`, `Runtime.execute` 内での `=` の扱い)**
    *   ファイル: `詳細設計書_インタープリタ_単一化処理.md`
    *   概要: Prologの根幹である単一化処理をUnion-Findベースで正確に実装します。多くのテスト失敗の根本原因解消を目指します。
2.  **`execute` メソッドにおける算術式 (`is`) の評価実装**
    *   ファイル: `詳細設計書_インタープリタ_算術式評価.md`
    *   概要: パースされた算術式を評価し、結果を変数に束縛します。
3.  **`execute` メソッドにおける比較演算の評価実装**
    *   ファイル: `詳細設計書_インタープリタ_比較演算評価.md`
    *   概要: パースされた比較演算を評価し、成功または失敗を返します。

## 4. インタープリタの改修 - 実行制御

Prologの実行モデルの核心部分を実装・修正します。

1.  **ルール適用とバックトラッキングの再検証**
    *   ファイル: `詳細設計書_インタープリタ_ルール適用とバックトラック.md`
    *   概要: ルールの検索、ヘッドとゴールの単一化、ルールボディの実行、変数の標準化、バックトラッキング処理全体を再検証・修正します。
2.  **カット (`!`) の処理**
    *   ファイル: `詳細設計書_インタープリタ_カット処理.md`
    *   概要: カット述語 (`!/0`) を実装し、バックトラッキングを正しく制御できるようにします。ルール適用とバックトラッキングが安定していることが前提となります。

## 5. インタープリタの改修 - 付加機能

基本的な実行モデルが安定した上で、動的な機能を追加・修正します。

1.  **動的データベース操作の修正 (`asserta`, `assertz`, `retract`)**
    *   ファイル: `詳細設計書_インタープリタ_動的DB操作.md`
    *   概要: ルールや事実の実行時追加・削除機能を正しく実装します。

この順序で対応することにより、依存関係による手戻りを最小限に抑え、効率的に改修を進めることができると期待されます。
